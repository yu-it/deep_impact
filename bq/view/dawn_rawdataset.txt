select
concat(format_datetime("%F",bac.date),"_",kyi.race_key_place_code,kyi.race_key_round) as primary_key,
kyi.race_key_place_code,
kyi.race_key_year,
kyi.race_key_no,
kyi.race_key_day,
kyi.race_key_round,
max(cat_place.meaning) as place_name,
max(bac.date) as date,
max(bac.race_condition_distance) as race_condition_distance,
max(bac.race_condition_track_grass_dart_etc) as race_condition_track_grass_dart_etc,
max(bac.race_condition_condition) as race_condition_condition,
max(bac.horse_count) as horse_count,
max(kab.weather_code) as weather_code,
max(kab.grass_field_status_code) as grass_field_status_code,
max(kab.dart_field_status_code) as dart_field_status_code,
max(case when kyi.horse_no = '01' then kyi.register_no else '' end) as register_no_01,
max(case when kyi.horse_no = '02' then kyi.register_no else '' end) as register_no_02,
max(case when kyi.horse_no = '03' then kyi.register_no else '' end) as register_no_03,
max(case when kyi.horse_no = '04' then kyi.register_no else '' end) as register_no_04,
max(case when kyi.horse_no = '05' then kyi.register_no else '' end) as register_no_05,
max(case when kyi.horse_no = '06' then kyi.register_no else '' end) as register_no_06,
max(case when kyi.horse_no = '07' then kyi.register_no else '' end) as register_no_07,
max(case when kyi.horse_no = '08' then kyi.register_no else '' end) as register_no_08,
max(case when kyi.horse_no = '09' then kyi.register_no else '' end) as register_no_09,
max(case when kyi.horse_no = '10' then kyi.register_no else '' end) as register_no_10,
max(case when kyi.horse_no = '11' then kyi.register_no else '' end) as register_no_11,
max(case when kyi.horse_no = '12' then kyi.register_no else '' end) as register_no_12,
max(case when kyi.horse_no = '13' then kyi.register_no else '' end) as register_no_13,
max(case when kyi.horse_no = '14' then kyi.register_no else '' end) as register_no_14,
max(case when kyi.horse_no = '15' then kyi.register_no else '' end) as register_no_15,
max(case when kyi.horse_no = '16' then kyi.register_no else '' end) as register_no_16,
max(case when kyi.horse_no = '17' then kyi.register_no else '' end) as register_no_17,
max(case when kyi.horse_no = '18' then kyi.register_no else '' end) as register_no_18,
max(case when kyi.horse_no = '01' then kyi.horse_name else '' end) as horse_name_01,
max(case when kyi.horse_no = '02' then kyi.horse_name else '' end) as horse_name_02,
max(case when kyi.horse_no = '03' then kyi.horse_name else '' end) as horse_name_03,
max(case when kyi.horse_no = '04' then kyi.horse_name else '' end) as horse_name_04,
max(case when kyi.horse_no = '05' then kyi.horse_name else '' end) as horse_name_05,
max(case when kyi.horse_no = '06' then kyi.horse_name else '' end) as horse_name_06,
max(case when kyi.horse_no = '07' then kyi.horse_name else '' end) as horse_name_07,
max(case when kyi.horse_no = '08' then kyi.horse_name else '' end) as horse_name_08,
max(case when kyi.horse_no = '09' then kyi.horse_name else '' end) as horse_name_09,
max(case when kyi.horse_no = '10' then kyi.horse_name else '' end) as horse_name_10,
max(case when kyi.horse_no = '11' then kyi.horse_name else '' end) as horse_name_11,
max(case when kyi.horse_no = '12' then kyi.horse_name else '' end) as horse_name_12,
max(case when kyi.horse_no = '13' then kyi.horse_name else '' end) as horse_name_13,
max(case when kyi.horse_no = '14' then kyi.horse_name else '' end) as horse_name_14,
max(case when kyi.horse_no = '15' then kyi.horse_name else '' end) as horse_name_15,
max(case when kyi.horse_no = '16' then kyi.horse_name else '' end) as horse_name_16,
max(case when kyi.horse_no = '17' then kyi.horse_name else '' end) as horse_name_17,
max(case when kyi.horse_no = '18' then kyi.horse_name else '' end) as horse_name_18,
max(case when kyi.horse_no = '01' then IDM else null end) as IDM_01,
max(case when kyi.horse_no = '02' then IDM else null end) as IDM_02,
max(case when kyi.horse_no = '03' then IDM else null end) as IDM_03,
max(case when kyi.horse_no = '04' then IDM else null end) as IDM_04,
max(case when kyi.horse_no = '05' then IDM else null end) as IDM_05,
max(case when kyi.horse_no = '06' then IDM else null end) as IDM_06,
max(case when kyi.horse_no = '07' then IDM else null end) as IDM_07,
max(case when kyi.horse_no = '08' then IDM else null end) as IDM_08,
max(case when kyi.horse_no = '09' then IDM else null end) as IDM_09,
max(case when kyi.horse_no = '10' then IDM else null end) as IDM_10,
max(case when kyi.horse_no = '11' then IDM else null end) as IDM_11,
max(case when kyi.horse_no = '12' then IDM else null end) as IDM_12,
max(case when kyi.horse_no = '13' then IDM else null end) as IDM_13,
max(case when kyi.horse_no = '14' then IDM else null end) as IDM_14,
max(case when kyi.horse_no = '15' then IDM else null end) as IDM_15,
max(case when kyi.horse_no = '16' then IDM else null end) as IDM_16,
max(case when kyi.horse_no = '17' then IDM else null end) as IDM_17,
max(case when kyi.horse_no = '18' then IDM else null end) as IDM_18,
max(case when kyi.horse_no = '01' then jockey_index else null end) as jockey_index_01,
max(case when kyi.horse_no = '02' then jockey_index else null end) as jockey_index_02,
max(case when kyi.horse_no = '03' then jockey_index else null end) as jockey_index_03,
max(case when kyi.horse_no = '04' then jockey_index else null end) as jockey_index_04,
max(case when kyi.horse_no = '05' then jockey_index else null end) as jockey_index_05,
max(case when kyi.horse_no = '06' then jockey_index else null end) as jockey_index_06,
max(case when kyi.horse_no = '07' then jockey_index else null end) as jockey_index_07,
max(case when kyi.horse_no = '08' then jockey_index else null end) as jockey_index_08,
max(case when kyi.horse_no = '09' then jockey_index else null end) as jockey_index_09,
max(case when kyi.horse_no = '10' then jockey_index else null end) as jockey_index_10,
max(case when kyi.horse_no = '11' then jockey_index else null end) as jockey_index_11,
max(case when kyi.horse_no = '12' then jockey_index else null end) as jockey_index_12,
max(case when kyi.horse_no = '13' then jockey_index else null end) as jockey_index_13,
max(case when kyi.horse_no = '14' then jockey_index else null end) as jockey_index_14,
max(case when kyi.horse_no = '15' then jockey_index else null end) as jockey_index_15,
max(case when kyi.horse_no = '16' then jockey_index else null end) as jockey_index_16,
max(case when kyi.horse_no = '17' then jockey_index else null end) as jockey_index_17,
max(case when kyi.horse_no = '18' then jockey_index else null end) as jockey_index_18,
max(case when kyi.horse_no = '01' then info_index else null end) as info_index_01,
max(case when kyi.horse_no = '02' then info_index else null end) as info_index_02,
max(case when kyi.horse_no = '03' then info_index else null end) as info_index_03,
max(case when kyi.horse_no = '04' then info_index else null end) as info_index_04,
max(case when kyi.horse_no = '05' then info_index else null end) as info_index_05,
max(case when kyi.horse_no = '06' then info_index else null end) as info_index_06,
max(case when kyi.horse_no = '07' then info_index else null end) as info_index_07,
max(case when kyi.horse_no = '08' then info_index else null end) as info_index_08,
max(case when kyi.horse_no = '09' then info_index else null end) as info_index_09,
max(case when kyi.horse_no = '10' then info_index else null end) as info_index_10,
max(case when kyi.horse_no = '11' then info_index else null end) as info_index_11,
max(case when kyi.horse_no = '12' then info_index else null end) as info_index_12,
max(case when kyi.horse_no = '13' then info_index else null end) as info_index_13,
max(case when kyi.horse_no = '14' then info_index else null end) as info_index_14,
max(case when kyi.horse_no = '15' then info_index else null end) as info_index_15,
max(case when kyi.horse_no = '16' then info_index else null end) as info_index_16,
max(case when kyi.horse_no = '17' then info_index else null end) as info_index_17,
max(case when kyi.horse_no = '18' then info_index else null end) as info_index_18,
max(case when kyi.horse_no = '01' then comprehension_index else null end) as comprehension_index_01,
max(case when kyi.horse_no = '02' then comprehension_index else null end) as comprehension_index_02,
max(case when kyi.horse_no = '03' then comprehension_index else null end) as comprehension_index_03,
max(case when kyi.horse_no = '04' then comprehension_index else null end) as comprehension_index_04,
max(case when kyi.horse_no = '05' then comprehension_index else null end) as comprehension_index_05,
max(case when kyi.horse_no = '06' then comprehension_index else null end) as comprehension_index_06,
max(case when kyi.horse_no = '07' then comprehension_index else null end) as comprehension_index_07,
max(case when kyi.horse_no = '08' then comprehension_index else null end) as comprehension_index_08,
max(case when kyi.horse_no = '09' then comprehension_index else null end) as comprehension_index_09,
max(case when kyi.horse_no = '10' then comprehension_index else null end) as comprehension_index_10,
max(case when kyi.horse_no = '11' then comprehension_index else null end) as comprehension_index_11,
max(case when kyi.horse_no = '12' then comprehension_index else null end) as comprehension_index_12,
max(case when kyi.horse_no = '13' then comprehension_index else null end) as comprehension_index_13,
max(case when kyi.horse_no = '14' then comprehension_index else null end) as comprehension_index_14,
max(case when kyi.horse_no = '15' then comprehension_index else null end) as comprehension_index_15,
max(case when kyi.horse_no = '16' then comprehension_index else null end) as comprehension_index_16,
max(case when kyi.horse_no = '17' then comprehension_index else null end) as comprehension_index_17,
max(case when kyi.horse_no = '18' then comprehension_index else null end) as comprehension_index_18,
max(case when kyi.horse_no = '01' then leg_status else '' end) as leg_status_01,
max(case when kyi.horse_no = '02' then leg_status else '' end) as leg_status_02,
max(case when kyi.horse_no = '03' then leg_status else '' end) as leg_status_03,
max(case when kyi.horse_no = '04' then leg_status else '' end) as leg_status_04,
max(case when kyi.horse_no = '05' then leg_status else '' end) as leg_status_05,
max(case when kyi.horse_no = '06' then leg_status else '' end) as leg_status_06,
max(case when kyi.horse_no = '07' then leg_status else '' end) as leg_status_07,
max(case when kyi.horse_no = '08' then leg_status else '' end) as leg_status_08,
max(case when kyi.horse_no = '09' then leg_status else '' end) as leg_status_09,
max(case when kyi.horse_no = '10' then leg_status else '' end) as leg_status_10,
max(case when kyi.horse_no = '11' then leg_status else '' end) as leg_status_11,
max(case when kyi.horse_no = '12' then leg_status else '' end) as leg_status_12,
max(case when kyi.horse_no = '13' then leg_status else '' end) as leg_status_13,
max(case when kyi.horse_no = '14' then leg_status else '' end) as leg_status_14,
max(case when kyi.horse_no = '15' then leg_status else '' end) as leg_status_15,
max(case when kyi.horse_no = '16' then leg_status else '' end) as leg_status_16,
max(case when kyi.horse_no = '17' then leg_status else '' end) as leg_status_17,
max(case when kyi.horse_no = '18' then leg_status else '' end) as leg_status_18,
max(case when kyi.horse_no = '01' then distance_apptitude else '' end) as distance_apptitude_01,
max(case when kyi.horse_no = '02' then distance_apptitude else '' end) as distance_apptitude_02,
max(case when kyi.horse_no = '03' then distance_apptitude else '' end) as distance_apptitude_03,
max(case when kyi.horse_no = '04' then distance_apptitude else '' end) as distance_apptitude_04,
max(case when kyi.horse_no = '05' then distance_apptitude else '' end) as distance_apptitude_05,
max(case when kyi.horse_no = '06' then distance_apptitude else '' end) as distance_apptitude_06,
max(case when kyi.horse_no = '07' then distance_apptitude else '' end) as distance_apptitude_07,
max(case when kyi.horse_no = '08' then distance_apptitude else '' end) as distance_apptitude_08,
max(case when kyi.horse_no = '09' then distance_apptitude else '' end) as distance_apptitude_09,
max(case when kyi.horse_no = '10' then distance_apptitude else '' end) as distance_apptitude_10,
max(case when kyi.horse_no = '11' then distance_apptitude else '' end) as distance_apptitude_11,
max(case when kyi.horse_no = '12' then distance_apptitude else '' end) as distance_apptitude_12,
max(case when kyi.horse_no = '13' then distance_apptitude else '' end) as distance_apptitude_13,
max(case when kyi.horse_no = '14' then distance_apptitude else '' end) as distance_apptitude_14,
max(case when kyi.horse_no = '15' then distance_apptitude else '' end) as distance_apptitude_15,
max(case when kyi.horse_no = '16' then distance_apptitude else '' end) as distance_apptitude_16,
max(case when kyi.horse_no = '17' then distance_apptitude else '' end) as distance_apptitude_17,
max(case when kyi.horse_no = '18' then distance_apptitude else '' end) as distance_apptitude_18,
max(case when kyi.horse_no = '01' then torture_index else null end) as torture_index_01,
max(case when kyi.horse_no = '02' then torture_index else null end) as torture_index_02,
max(case when kyi.horse_no = '03' then torture_index else null end) as torture_index_03,
max(case when kyi.horse_no = '04' then torture_index else null end) as torture_index_04,
max(case when kyi.horse_no = '05' then torture_index else null end) as torture_index_05,
max(case when kyi.horse_no = '06' then torture_index else null end) as torture_index_06,
max(case when kyi.horse_no = '07' then torture_index else null end) as torture_index_07,
max(case when kyi.horse_no = '08' then torture_index else null end) as torture_index_08,
max(case when kyi.horse_no = '09' then torture_index else null end) as torture_index_09,
max(case when kyi.horse_no = '10' then torture_index else null end) as torture_index_10,
max(case when kyi.horse_no = '11' then torture_index else null end) as torture_index_11,
max(case when kyi.horse_no = '12' then torture_index else null end) as torture_index_12,
max(case when kyi.horse_no = '13' then torture_index else null end) as torture_index_13,
max(case when kyi.horse_no = '14' then torture_index else null end) as torture_index_14,
max(case when kyi.horse_no = '15' then torture_index else null end) as torture_index_15,
max(case when kyi.horse_no = '16' then torture_index else null end) as torture_index_16,
max(case when kyi.horse_no = '17' then torture_index else null end) as torture_index_17,
max(case when kyi.horse_no = '18' then torture_index else null end) as torture_index_18,
max(case when kyi.horse_no = '01' then passion_index else null end) as passion_index_01,
max(case when kyi.horse_no = '02' then passion_index else null end) as passion_index_02,
max(case when kyi.horse_no = '03' then passion_index else null end) as passion_index_03,
max(case when kyi.horse_no = '04' then passion_index else null end) as passion_index_04,
max(case when kyi.horse_no = '05' then passion_index else null end) as passion_index_05,
max(case when kyi.horse_no = '06' then passion_index else null end) as passion_index_06,
max(case when kyi.horse_no = '07' then passion_index else null end) as passion_index_07,
max(case when kyi.horse_no = '08' then passion_index else null end) as passion_index_08,
max(case when kyi.horse_no = '09' then passion_index else null end) as passion_index_09,
max(case when kyi.horse_no = '10' then passion_index else null end) as passion_index_10,
max(case when kyi.horse_no = '11' then passion_index else null end) as passion_index_11,
max(case when kyi.horse_no = '12' then passion_index else null end) as passion_index_12,
max(case when kyi.horse_no = '13' then passion_index else null end) as passion_index_13,
max(case when kyi.horse_no = '14' then passion_index else null end) as passion_index_14,
max(case when kyi.horse_no = '15' then passion_index else null end) as passion_index_15,
max(case when kyi.horse_no = '16' then passion_index else null end) as passion_index_16,
max(case when kyi.horse_no = '17' then passion_index else null end) as passion_index_17,
max(case when kyi.horse_no = '18' then passion_index else null end) as passion_index_18,
max(case when kyi.horse_no = '01' then load_weight else null end) as load_weight_01,
max(case when kyi.horse_no = '02' then load_weight else null end) as load_weight_02,
max(case when kyi.horse_no = '03' then load_weight else null end) as load_weight_03,
max(case when kyi.horse_no = '04' then load_weight else null end) as load_weight_04,
max(case when kyi.horse_no = '05' then load_weight else null end) as load_weight_05,
max(case when kyi.horse_no = '06' then load_weight else null end) as load_weight_06,
max(case when kyi.horse_no = '07' then load_weight else null end) as load_weight_07,
max(case when kyi.horse_no = '08' then load_weight else null end) as load_weight_08,
max(case when kyi.horse_no = '09' then load_weight else null end) as load_weight_09,
max(case when kyi.horse_no = '10' then load_weight else null end) as load_weight_10,
max(case when kyi.horse_no = '11' then load_weight else null end) as load_weight_11,
max(case when kyi.horse_no = '12' then load_weight else null end) as load_weight_12,
max(case when kyi.horse_no = '13' then load_weight else null end) as load_weight_13,
max(case when kyi.horse_no = '14' then load_weight else null end) as load_weight_14,
max(case when kyi.horse_no = '15' then load_weight else null end) as load_weight_15,
max(case when kyi.horse_no = '16' then load_weight else null end) as load_weight_16,
max(case when kyi.horse_no = '17' then load_weight else null end) as load_weight_17,
max(case when kyi.horse_no = '18' then load_weight else null end) as load_weight_18,
max(case when kyi.horse_no = '01' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_01,
max(case when kyi.horse_no = '02' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_02,
max(case when kyi.horse_no = '03' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_03,
max(case when kyi.horse_no = '04' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_04,
max(case when kyi.horse_no = '05' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_05,
max(case when kyi.horse_no = '06' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_06,
max(case when kyi.horse_no = '07' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_07,
max(case when kyi.horse_no = '08' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_08,
max(case when kyi.horse_no = '09' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_09,
max(case when kyi.horse_no = '10' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_10,
max(case when kyi.horse_no = '11' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_11,
max(case when kyi.horse_no = '12' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_12,
max(case when kyi.horse_no = '13' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_13,
max(case when kyi.horse_no = '14' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_14,
max(case when kyi.horse_no = '15' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_15,
max(case when kyi.horse_no = '16' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_16,
max(case when kyi.horse_no = '17' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_17,
max(case when kyi.horse_no = '18' then prize_info_obtain_prize else null end) as prize_info_obtain_prize_18,
max(case when kyi.horse_no = '01' then sex else '' end) as sex_01,
max(case when kyi.horse_no = '02' then sex else '' end) as sex_02,
max(case when kyi.horse_no = '03' then sex else '' end) as sex_03,
max(case when kyi.horse_no = '04' then sex else '' end) as sex_04,
max(case when kyi.horse_no = '05' then sex else '' end) as sex_05,
max(case when kyi.horse_no = '06' then sex else '' end) as sex_06,
max(case when kyi.horse_no = '07' then sex else '' end) as sex_07,
max(case when kyi.horse_no = '08' then sex else '' end) as sex_08,
max(case when kyi.horse_no = '09' then sex else '' end) as sex_09,
max(case when kyi.horse_no = '10' then sex else '' end) as sex_10,
max(case when kyi.horse_no = '11' then sex else '' end) as sex_11,
max(case when kyi.horse_no = '12' then sex else '' end) as sex_12,
max(case when kyi.horse_no = '13' then sex else '' end) as sex_13,
max(case when kyi.horse_no = '14' then sex else '' end) as sex_14,
max(case when kyi.horse_no = '15' then sex else '' end) as sex_15,
max(case when kyi.horse_no = '16' then sex else '' end) as sex_16,
max(case when kyi.horse_no = '17' then sex else '' end) as sex_17,
max(case when kyi.horse_no = '18' then sex else '' end) as sex_18,
max(case when sed.horse_no = '01' then horse_performance_order else null end) as horse_performance_order_01,
max(case when sed.horse_no = '02' then horse_performance_order else null end) as horse_performance_order_02,
max(case when sed.horse_no = '03' then horse_performance_order else null end) as horse_performance_order_03,
max(case when sed.horse_no = '04' then horse_performance_order else null end) as horse_performance_order_04,
max(case when sed.horse_no = '05' then horse_performance_order else null end) as horse_performance_order_05,
max(case when sed.horse_no = '06' then horse_performance_order else null end) as horse_performance_order_06,
max(case when sed.horse_no = '07' then horse_performance_order else null end) as horse_performance_order_07,
max(case when sed.horse_no = '08' then horse_performance_order else null end) as horse_performance_order_08,
max(case when sed.horse_no = '09' then horse_performance_order else null end) as horse_performance_order_09,
max(case when sed.horse_no = '10' then horse_performance_order else null end) as horse_performance_order_10,
max(case when sed.horse_no = '11' then horse_performance_order else null end) as horse_performance_order_11,
max(case when sed.horse_no = '12' then horse_performance_order else null end) as horse_performance_order_12,
max(case when sed.horse_no = '13' then horse_performance_order else null end) as horse_performance_order_13,
max(case when sed.horse_no = '14' then horse_performance_order else null end) as horse_performance_order_14,
max(case when sed.horse_no = '15' then horse_performance_order else null end) as horse_performance_order_15,
max(case when sed.horse_no = '16' then horse_performance_order else null end) as horse_performance_order_16,
max(case when sed.horse_no = '17' then horse_performance_order else null end) as horse_performance_order_17,
max(case when sed.horse_no = '18' then horse_performance_order else null end) as horse_performance_order_18,
18 - ((max(case when sed.horse_no = '01' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_01_reversed,
18 - ((max(case when sed.horse_no = '02' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_02_reversed,
18 - ((max(case when sed.horse_no = '03' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_03_reversed,
18 - ((max(case when sed.horse_no = '04' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_04_reversed,
18 - ((max(case when sed.horse_no = '05' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_05_reversed,
18 - ((max(case when sed.horse_no = '06' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_06_reversed,
18 - ((max(case when sed.horse_no = '07' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_07_reversed,
18 - ((max(case when sed.horse_no = '08' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_08_reversed,
18 - ((max(case when sed.horse_no = '09' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_09_reversed,
18 - ((max(case when sed.horse_no = '10' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_10_reversed,
18 - ((max(case when sed.horse_no = '11' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_11_reversed,
18 - ((max(case when sed.horse_no = '12' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_12_reversed,
18 - ((max(case when sed.horse_no = '13' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_13_reversed,
18 - ((max(case when sed.horse_no = '14' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_14_reversed,
18 - ((max(case when sed.horse_no = '15' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_15_reversed,
18 - ((max(case when sed.horse_no = '16' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_16_reversed,
18 - ((max(case when sed.horse_no = '17' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_17_reversed,
18 - ((max(case when sed.horse_no = '18' then horse_performance_order else null end) - 1) * (18 / count(1))) as horse_performance_order_18_reversed
from
`yu-it-base.jrdb_raw_data.a_bac` bac
inner join `yu-it-base.jrdb_raw_data.a_kab` kab  on
    bac.partitioning_date = kab.partitioning_date
    and bac.race_key_place_code = kab.held_key_place_code
inner join `yu-it-base.jrdb_raw_data.a_kyi` kyi  on
    bac.partitioning_date = kyi.partitioning_date
    and bac.race_key_place_code = kyi.race_key_place_code
    and bac.race_key_round = kyi.race_key_round
inner join  `yu-it-base.jrdb_raw_data_schema_info.category_mst` cat_place
    on
    cat_place.table_name = 'a_kyi' and cat_place.column_pysical_name = 'race_key_place_code'
    and cat_place.category = kyi.race_key_place_code 
inner join `yu-it-base.jrdb_raw_data.a_sed` sed  on
    bac.partitioning_date = sed.partitioning_date
    and bac.race_key_place_code = sed.race_key_place_code
    and bac.race_key_round = sed.race_key_round
    and kyi.horse_no = sed.horse_no
group by concat(format_datetime("%F",bac.date),"_",kyi.race_key_place_code,kyi.race_key_round) ,kyi.race_key_place_code,kyi.race_key_year,kyi.race_key_no,kyi.race_key_day,kyi.race_key_round
